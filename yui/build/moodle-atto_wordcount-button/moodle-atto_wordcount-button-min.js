YUI.add("moodle-atto_wordcount-button",function(e,t){var n=0;e.namespace("M.atto_wordcount").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{block:0,updateRate:200,counterid:null,spacer:/(<\/(?!a>|b>|del>|em>|i>|ins>|s>|small>|strong>|sub>|sup>|u>)\w+>|<br> | <br\s*\/>)/g,mediaTags:/(<(audio|video)).*(<\/(audio|video)>)/gm,counter:new RegExp("[\\p{Z}\\p{Cc}\u2014\u2013]+","gu"),initializer:function(){var t=this.get("host"),r=t._wrapper;this.counterid=t.get("elementid")+"-word-count",this.counterid=this.counterid.replace(":","-"),this.counterElement=e.Node.create('<span class="badge badge-light" id="'+this.counterid+'">0</span>'),this.wordlimit=this.get("wordlimits")[n];if(this.wordlimit!==0&&this.wordlimit!=null){r.appendChild(e.Node.create('<div class="'+this.toolbar.getAttribute("class")+' editor_atto_toolbar_bottom p-0 d-flex">'+'<div class="d-inline-flex p-1"><strong>'+M.util.get_string("words","atto_wordcount")+": "+'</strong><span id="'+this.counterid+'">0</span>'+"</div></div>"));if(this.wordlimit){var i=document.createElement("span");i.innerHTML="/",document.getElementById(this.counterid).parentNode.appendChild(i);var s=document.createElement("span");s.innerHTML=this.wordlimit,document.getElementById(this.counterid).parentNode.appendChild(s)}n+=1,this._count(t.get("editor")),this.get("host").on("pluginsloaded",function(){this.get("host").on("atto:selectionchanged",this._count,this)},this)}},_count:function(t){var n=this;if(n.block)return;n.block=1,setTimeout(function(){var r=n._getCount(t);e.one("#"+n.counterid).set("text",r),n.wordlimit&&(n.wordlimit-r<0?(e.one("#"+n.counterid).addClass("danger"),e.one("#"+n.counterid).removeClass("warning")):n.wordlimit-r<10?(e.one("#"+n.counterid).addClass("warning"),e.one("#"+n.counterid).removeClass("danger")):(e.one("#"+n.counterid).removeClass("warning"),e.one("#"+n.counterid).removeClass("danger"))),setTimeout(function(){n.block=0},n.updateRate)})},_getCount:function(){var e=0,t=this.get("host").getCleanHTML();if(t){t=t.replace(this.spacer,"$1 "),t=t.replace(/<.[^<>]*?>/g,""),t=t.replace(/&nbsp;|&#160;/gi,"\u00a0");var n=t.split(this.counter,-1);n=n.filter(function(e){return e.trim()!=""}),n&&(e=n.length)}return e}},{ATTRS:{wordlimits:{value:[0]}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
